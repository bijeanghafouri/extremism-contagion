#################### merge idealpoints datafiles ###################
# This code takes in the individual files that Pablo put in HPC account (individual-level ideal points) and merges them into one large file
library(parallel)
library(data.table)
cores <- as.integer(Sys.getenv("SLURM_CPUS_PER_TASK")) - 1


# -------------- read files ------------------
files <- c('/project/pbarbera_665/bghafour/twitter-2020-election/user-ideal-points-202008_000000000000', '/project/pbarbera_665/bghafour/twitter-2020-election/user-ideal-points-202008_000000000001', '/project/pbarbera_665/bghafour/twitter-2020-election/user-ideal-points-202008_000000000002', '/project/pbarbera_665/bghafour/twitter-2020-election/user-ideal-points-202008_000000000003', '/project/pbarbera_665/bghafour/twitter-2020-election/user-ideal-points-202008_000000000004', '/project/pbarbera_665/bghafour/twitter-2020-election/user-ideal-points-202008_000000000005', '/project/pbarbera_665/bghafour/twitter-2020-election/user-ideal-points-202008_000000000006')

data <- parallel::mclapply(files, data.table::fread, mc.cores = cores)
data_list <- data.table::rbindlist(data)

# ---------- output -----------
setwd('/project/pbarbera_665/bghafour/twitter-2020-election/data')
fwrite(data_list, 'ideal-points-merged.csv')

